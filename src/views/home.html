<header class="fm-header">
  <h4 class="fm-regular">
    {{session.flat.name}}
  </h4>
  <ul class="push-right" fm-drop-down>
    <li ng-if="session._id === session.flat.owner._id">
      <a href="#/edit-flat">
        EDITAR PISO
      </a>
    </li>
    <li>
      <button ng-click="logout()">POWER OFF</button>
    </li>
  </ul>
</header>

<!-- TODO make a directive to show the task card -->
<section class="fm-pane fm-content" ng-class="{active:panes.myTasksActive}">
  <ul class="fm-cards-wrapper">
    <li class="fm-card clear" ng-repeat="task in session.flat.tasks track by $index"
        ng-if="(task | isMyTask :session.flat.mates) && !(task | taskIsDone)">
      <div ng-if="!task.spin">
        <header>
          <i class="fm-card-icon-type fa fa-align-left"></i>
        </header>
        <p>{{task.title}}</p>
        <button class="fm-button-soft to-right"
                ng-click="markTaskAsDone(task)">
          Finalizar tarea
        </button>
      </div>
      <div ng-if="task.spin">
        <header>
          <i class="fm-card-icon-type fa fa-rotate-right"></i>
        </header>
        <p>{{task.title}}: {{task.history | spinTaskForMe}}</p>
        <button class="fm-button-soft to-right"
                ng-click="markTaskAsDone(task)">
          Finalizar tarea
        </button>
      </div>
    </li>

    <li class="fm-empty-card-list" ng-if="messageEmptyFlatOrTasks()">
      {{messageEmptyFlatOrTasks()}}
      <div ng-if="!session.flat">
        <button class="fm-button" ng-click="newFlatButton()">
          Crear piso
        </button>
      </div>
    </li>

    <li class="fm-empty-card-list"
        ng-if="session.flat.tasks && !messageEmptyFlatOrTasks() &&
               (session.flat.tasks | noTasksForMe :session.flat.mates)">
      No tienes tareas pendientes
    </li>
  </ul>
</section>
<section class="fm-pane fm-content" ng-class="{active:panes.tasksActive}">
  <ul class="fm-cards-wrapper">
    <li class="fm-card clear" ng-repeat="task in session.flat.tasks track by $index"
        ng-if="(!task.spin && !task.done) ||
               (task.spin && (task | spinTaskAllDone))">
      <div ng-if="!task.spin">
        <header>
          <i class="fm-card-icon-type fa fa-align-left"></i>
        </header>
        <p>
          {{task.title}}
          <span class="fm-cad-who">
            <i class="fa fa-long-arrow-right"></i>
            {{task.who | whoIs :session.flat.mates}}
          </span>
        </p>
        <button class="fm-button-soft to-right"
                ng-click="markTaskAsDone(task)">
          Finalizar tarea
        </button>
      </div>
      <div ng-if="task.spin">
        <header>
          <i class="fm-card-icon-type fa fa-rotate-right"></i>
        </header>
        <p>
          {{task.title}}
          <ul>
            <li ng-repeat="subtask in task.history[task.history.length - 1].subtasks"
            ng-if="!subtask.done">
              - {{subtask.subtask.value}}
              <span class="fm-cad-who">
                <i class="fa fa-long-arrow-right"></i>
                {{subtask.who | whoIs :session.flat.mates}}
              </span>
            </li>
          </ul>
        </p>
      </div>
    </li>
    <li class="fm-empty-card-list" ng-if="!session.flat.tasks.length">
      {{messageEmptyFlatOrTasks()}}
    </li>
  </ul>
</section>

<section fm-tabs ng-if="session.flat" class="fm-tabs" role="tab-bar">
  <li fm-tab class="fm-tab" ng-click="changePaneTo(0)">Mis tareas</li>
  <li fm-tab class="fm-tab" ng-click="changePaneTo(1)">Tareas</li>
  <div fm-indicator class="fm-indicator"></div>
</section>
